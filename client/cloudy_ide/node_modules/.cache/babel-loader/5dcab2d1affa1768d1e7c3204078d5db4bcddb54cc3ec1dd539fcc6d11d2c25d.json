{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\dzung\\\\project\\\\cloudy\\\\client\\\\cloudy_ide\\\\src\\\\CodeEditor.jsx\",\n  _s = $RefreshSig$();\nimport React, { useRef, useEffect } from 'react';\nimport CodeMirror from '@uiw/react-codemirror';\nimport { javascript } from '@codemirror/lang-javascript';\nimport * as Y from 'yjs';\nimport { yUndoPlugin, ySyncPlugin } from 'y-codemirror.next';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nfunction CodeEditor(props) {\n  _s();\n  const editorRef = useRef();\n  const yDocRef = useRef();\n  useEffect(() => {\n    const editor = editorRef.current.editor;\n    const ydoc = new Y.Doc();\n    ydoc.clientID = Math.floor(Math.random() * 2 ** 31);\n    editor.addKeyMap({\n      'Ctrl-Z': cm => yUndoPlugin(cm.doc),\n      'Ctrl-Y': cm => yUndoPlugin(cm.doc, true)\n    });\n    editor.on('changes', (instance, changes) => {\n      const ytext = ydoc.getText('codemirror');\n      changes.forEach(_ref => {\n        let {\n          text,\n          from,\n          to\n        } = _ref;\n        ytext.delete(from, to - from);\n        ytext.insert(from, text);\n      });\n    });\n    const ySync = ySyncPlugin(editor, ydoc.getText('codemirror'));\n    ySync.setOption('retainUndoStack', true);\n    yDocRef.current = ydoc;\n    editorRef.current = editor;\n    return () => {\n      ySync.destroy();\n      ydoc.destroy();\n    };\n  }, []);\n  return /*#__PURE__*/_jsxDEV(CodeMirror, {\n    value: props.code,\n    height: \"200px\",\n    extensions: [javascript({\n      jsx: true\n    })],\n    onChange: props.onChange\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 43,\n    columnNumber: 9\n  }, this);\n}\n_s(CodeEditor, \"71FMWtX8PBo9zbK05ZyslA3Wn3c=\");\n_c = CodeEditor;\nexport default CodeEditor;\nvar _c;\n$RefreshReg$(_c, \"CodeEditor\");","map":{"version":3,"names":["React","useRef","useEffect","CodeMirror","javascript","Y","yUndoPlugin","ySyncPlugin","jsxDEV","_jsxDEV","CodeEditor","props","_s","editorRef","yDocRef","editor","current","ydoc","Doc","clientID","Math","floor","random","addKeyMap","cm","doc","on","instance","changes","ytext","getText","forEach","_ref","text","from","to","delete","insert","ySync","setOption","destroy","value","code","height","extensions","jsx","onChange","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["C:/Users/dzung/project/cloudy/client/cloudy_ide/src/CodeEditor.jsx"],"sourcesContent":["import React, { useRef, useEffect } from 'react'\r\nimport CodeMirror from '@uiw/react-codemirror';\r\nimport { javascript } from '@codemirror/lang-javascript';\r\nimport * as Y from 'yjs'\r\nimport { yUndoPlugin, ySyncPlugin} from 'y-codemirror.next'\r\n\r\nfunction CodeEditor(props) {\r\n    const editorRef = useRef()\r\n    const yDocRef = useRef()\r\n    useEffect(() => {\r\n        const editor = editorRef.current.editor\r\n        const ydoc = new Y.Doc();\r\n\r\n        ydoc.clientID = Math.floor(Math.random() * 2 ** 31);\r\n\r\n        editor.addKeyMap({\r\n            'Ctrl-Z': (cm) => yUndoPlugin(cm.doc),\r\n            'Ctrl-Y': (cm) => yUndoPlugin(cm.doc, true),\r\n        });\r\n\r\n        editor.on('changes', (instance, changes) => {\r\n            const ytext = ydoc.getText('codemirror');\r\n            changes.forEach(({ text, from, to }) => {\r\n                ytext.delete(from, to - from);\r\n                ytext.insert(from, text);\r\n            });\r\n        });\r\n\r\n    const ySync = ySyncPlugin(editor, ydoc.getText('codemirror'));\r\n    ySync.setOption('retainUndoStack', true);\r\n\r\n    yDocRef.current = ydoc;\r\n    editorRef.current = editor;\r\n\r\n    return () => {\r\n      ySync.destroy();\r\n      ydoc.destroy();\r\n    };\r\n    }, [])\r\n    \r\n\r\n    return (\r\n        <CodeMirror\r\n            value={props.code}\r\n            height=\"200px\"\r\n            extensions={[javascript({ jsx: true })]}\r\n            onChange={props.onChange}\r\n        />\r\n    )\r\n}\r\n\r\nexport default CodeEditor"],"mappings":";;AAAA,OAAOA,KAAK,IAAIC,MAAM,EAAEC,SAAS,QAAQ,OAAO;AAChD,OAAOC,UAAU,MAAM,uBAAuB;AAC9C,SAASC,UAAU,QAAQ,6BAA6B;AACxD,OAAO,KAAKC,CAAC,MAAM,KAAK;AACxB,SAASC,WAAW,EAAEC,WAAW,QAAO,mBAAmB;AAAA,SAAAC,MAAA,IAAAC,OAAA;AAE3D,SAASC,UAAUA,CAACC,KAAK,EAAE;EAAAC,EAAA;EACvB,MAAMC,SAAS,GAAGZ,MAAM,EAAE;EAC1B,MAAMa,OAAO,GAAGb,MAAM,EAAE;EACxBC,SAAS,CAAC,MAAM;IACZ,MAAMa,MAAM,GAAGF,SAAS,CAACG,OAAO,CAACD,MAAM;IACvC,MAAME,IAAI,GAAG,IAAIZ,CAAC,CAACa,GAAG,EAAE;IAExBD,IAAI,CAACE,QAAQ,GAAGC,IAAI,CAACC,KAAK,CAACD,IAAI,CAACE,MAAM,EAAE,GAAG,CAAC,IAAI,EAAE,CAAC;IAEnDP,MAAM,CAACQ,SAAS,CAAC;MACb,QAAQ,EAAGC,EAAE,IAAKlB,WAAW,CAACkB,EAAE,CAACC,GAAG,CAAC;MACrC,QAAQ,EAAGD,EAAE,IAAKlB,WAAW,CAACkB,EAAE,CAACC,GAAG,EAAE,IAAI;IAC9C,CAAC,CAAC;IAEFV,MAAM,CAACW,EAAE,CAAC,SAAS,EAAE,CAACC,QAAQ,EAAEC,OAAO,KAAK;MACxC,MAAMC,KAAK,GAAGZ,IAAI,CAACa,OAAO,CAAC,YAAY,CAAC;MACxCF,OAAO,CAACG,OAAO,CAACC,IAAA,IAAwB;QAAA,IAAvB;UAAEC,IAAI;UAAEC,IAAI;UAAEC;QAAG,CAAC,GAAAH,IAAA;QAC/BH,KAAK,CAACO,MAAM,CAACF,IAAI,EAAEC,EAAE,GAAGD,IAAI,CAAC;QAC7BL,KAAK,CAACQ,MAAM,CAACH,IAAI,EAAED,IAAI,CAAC;MAC5B,CAAC,CAAC;IACN,CAAC,CAAC;IAEN,MAAMK,KAAK,GAAG/B,WAAW,CAACQ,MAAM,EAAEE,IAAI,CAACa,OAAO,CAAC,YAAY,CAAC,CAAC;IAC7DQ,KAAK,CAACC,SAAS,CAAC,iBAAiB,EAAE,IAAI,CAAC;IAExCzB,OAAO,CAACE,OAAO,GAAGC,IAAI;IACtBJ,SAAS,CAACG,OAAO,GAAGD,MAAM;IAE1B,OAAO,MAAM;MACXuB,KAAK,CAACE,OAAO,EAAE;MACfvB,IAAI,CAACuB,OAAO,EAAE;IAChB,CAAC;EACD,CAAC,EAAE,EAAE,CAAC;EAGN,oBACI/B,OAAA,CAACN,UAAU;IACPsC,KAAK,EAAE9B,KAAK,CAAC+B,IAAK;IAClBC,MAAM,EAAC,OAAO;IACdC,UAAU,EAAE,CAACxC,UAAU,CAAC;MAAEyC,GAAG,EAAE;IAAK,CAAC,CAAC,CAAE;IACxCC,QAAQ,EAAEnC,KAAK,CAACmC;EAAS;IAAAC,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,QAC3B;AAEV;AAACtC,EAAA,CA3CQF,UAAU;AAAAyC,EAAA,GAAVzC,UAAU;AA6CnB,eAAeA,UAAU;AAAA,IAAAyC,EAAA;AAAAC,YAAA,CAAAD,EAAA"},"metadata":{},"sourceType":"module","externalDependencies":[]}